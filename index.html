<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nautical Puzzle Hub</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header onclick="toggleDevTools()">
    üß≠ Nautical Puzzle Hub
  </header>
  <nav>
    <div id="keyword-banner"></div>
    <button class="tab" data-target="control-unlock">‚öì Control Unlock</button>
    <button class="tab" data-target="spot-diff">üîç Porthole Puzzle</button>
    <button class="tab" data-target="ballast">‚öñÔ∏è Ballast Balance</button>
    <button class="tab" data-target="sonar">üì° Sonar Shapes</button>
    <button class="tab" data-target="navigation">üó∫Ô∏è Nav Riddle</button>
  </nav>

  <div id="dev-tools">
    <strong>üõ†Ô∏è Dev Tools</strong>
    <button onclick="resetGame()">üîÑ Reset Puzzle</button>
    <button onclick="revealSolution()">üëÅÔ∏è Reveal Code</button>
    <div id="dev-output"></div>
  </div>

  <section id="control-unlock" class="active">
    <div class="content-box" id="puzzle-box">
      <h2>‚öì Control Unlock</h2>
      <p>Guess the hidden 4-color signal used by the submarine crew to unlock the vault. You have 10 tries to break the code!</p>
      <div class="board" id="board"></div>
      <div class="color-picker" id="color-picker"></div>
    </div>
  </section>

  <section id="spot-diff">
    <div class="content-box">
      <div class="porthole-puzzle">
        <div class="porthole-intro">
          <h2>üîç Porthole Puzzle</h2>
          <p>
            Two observation windows show the sea outside the submarine. Study the port and starboard scenes,
            then tap every mismatch to flag it for the crew.
          </p>
        </div>
        <div class="porthole-scenes">
          <div class="porthole-scene" data-scene="port">
            <div class="porthole-frame">
              <div class="porthole-glass" role="img" aria-label="Port observation porthole">
                <div class="scene-detail hull"></div>
                <div class="scene-detail tower"></div>
                <div class="scene-detail viewport viewport-a"></div>
                <div class="scene-detail viewport viewport-b"></div>
                <div class="scene-detail viewport viewport-c"></div>
                <div class="scene-detail buoy"></div>
                <div class="scene-detail kelp kelp-port"></div>
                <div class="scene-detail kelp kelp-starboard"></div>
                <div class="scene-detail jellyfish"></div>
                <div class="scene-detail sonar"></div>
                <div class="scene-detail bubbles cluster-one"></div>
                <div class="scene-detail bubbles cluster-two"></div>
              </div>
            </div>
            <div class="porthole-label">Port Observation</div>
          </div>
          <div class="porthole-scene" data-scene="starboard">
            <div class="porthole-frame">
              <div class="porthole-glass" role="img" aria-label="Starboard observation porthole">
                <div class="scene-detail hull"></div>
                <div class="scene-detail tower"></div>
                <div class="scene-detail viewport viewport-a"></div>
                <div class="scene-detail viewport viewport-b"></div>
                <div class="scene-detail viewport viewport-c"></div>
                <div class="scene-detail buoy"></div>
                <div class="scene-detail kelp kelp-port"></div>
                <div class="scene-detail kelp kelp-starboard"></div>
                <div class="scene-detail jellyfish"></div>
                <div class="scene-detail sonar"></div>
                <div class="scene-detail bubbles cluster-one"></div>
                <div class="scene-detail bubbles cluster-two"></div>
              </div>
            </div>
            <div class="porthole-label">Starboard Observation</div>
          </div>
        </div>
        <div class="porthole-progress" role="status" aria-live="polite">
          Found <span id="porthole-found-count">0</span> of <span id="porthole-total-count">0</span> differences ¬∑
          <span class="porthole-progress-message" id="porthole-progress-message">Mark each mismatch to light the signal.</span>
        </div>
        <div class="porthole-success" id="porthole-success" aria-live="assertive">
          <p>All differences spotted! Keyword:</p>
          <p class="porthole-keyword" id="porthole-keyword"></p>
        </div>
      </div>
    </div>
  </section>

  <section id="ballast">
    <div class="content-box ballast-panel" id="ballast-panel">
      <div>
        <h2>‚öñÔ∏è Ballast Balance</h2>
        <p>Trim the submarine by tuning the ballast levers. Use the polarity switch to vent or flood tanks, then lock in your adjustments before alarms overwhelm the crew.</p>
      </div>
      <div class="ballast-body">
        <div class="ballast-controls">
          <div class="lever-bank">
            <div class="ballast-lever" data-lever="bow">
              <div class="lever-title">Bow Flood</div>
              <div class="lever-track">
                <span class="lever-stop">VENT</span>
                <input type="range" min="0" max="4" value="2" />
                <span class="lever-stop">FLOOD</span>
              </div>
              <div class="lever-readout">Trim shift: <span class="lever-value">0</span></div>
            </div>
            <div class="ballast-lever" data-lever="stern">
              <div class="lever-title">Stern Pumps</div>
              <div class="lever-track">
                <span class="lever-stop">VENT</span>
                <input type="range" min="0" max="4" value="2" />
                <span class="lever-stop">FLOOD</span>
              </div>
              <div class="lever-readout">Trim shift: <span class="lever-value">0</span></div>
            </div>
            <div class="ballast-lever" data-lever="port">
              <div class="lever-title">Port Trim</div>
              <div class="lever-track">
                <span class="lever-stop">VENT</span>
                <input type="range" min="0" max="4" value="2" />
                <span class="lever-stop">FLOOD</span>
              </div>
              <div class="lever-readout">Trim shift: <span class="lever-value">0</span></div>
            </div>
            <div class="ballast-lever" data-lever="starboard">
              <div class="lever-title">Starboard Trim</div>
              <div class="lever-track">
                <span class="lever-stop">VENT</span>
                <input type="range" min="0" max="4" value="2" />
                <span class="lever-stop">FLOOD</span>
              </div>
              <div class="lever-readout">Trim shift: <span class="lever-value">0</span></div>
            </div>
          </div>
          <div class="ballast-actions">
            <button id="ballast-polarity" class="toggle-button">Polarity: Flood Tanks</button>
            <button id="ballast-confirm" class="confirm-button">Confirm Adjustment</button>
            <div class="ballast-moves">Moves remaining: <span id="ballast-moves">0</span></div>
            <div class="ballast-digital" id="ballast-digital">Stability score: --</div>
          </div>
        </div>
        <div class="ballast-gauges">
          <div class="gauge tilt-gauge">
            <div class="gauge-face">
              <div class="needle"></div>
              <div class="gauge-center"></div>
            </div>
            <div class="gauge-label">Trim Gauge</div>
            <div class="gauge-readout" id="ballast-tilt-readout">--</div>
          </div>
          <div class="gauge depth-gauge">
            <div class="gauge-face">
              <div class="needle"></div>
              <div class="gauge-center"></div>
            </div>
            <div class="gauge-label">Depth Gauge</div>
            <div class="gauge-readout" id="ballast-depth-readout">--</div>
          </div>
        </div>
      </div>
      <div class="ballast-status" id="ballast-status">Ballast array warming up‚Ä¶</div>
      <div class="ballast-outcome" id="ballast-outcome"></div>
      <div class="ballast-reset">
        <button id="ballast-reset">Reset Ballast System</button>
      </div>
    </div>
  </section>

  <section id="sonar">
    <div class="content-box">
      <div class="sonar-console">
        <div>
          <h2>üì° Sonar Shapes</h2>
          <p class="sonar-description">
            Cycle the pings to trace the contact silhouette. The row and column readouts show how many sonar pips should glow in
            each line‚Äîovercharge a lane and the console will refuse the input.
          </p>
        </div>
        <div class="sonar-grid" id="sonar-grid" role="grid" aria-label="Sonar targeting grid"></div>
        <p class="sonar-clue" id="sonar-clue"></p>
        <div class="sonar-success" id="sonar-success" hidden>
          <strong>Keyword detected:</strong> <span id="sonar-keyword">TORPEDO</span>
        </div>
      </div>
    </div>
  </section>

  <section id="navigation">
    <div class="content-box nav-riddle" id="nav-riddle">
      <h2>üó∫Ô∏è Nav Riddle</h2>
      <p class="nav-story">
        A midnight squall scattered the plotting room notes. To unlock the helm, decode the captain's layered message and
        broadcast the keyword back to the bridge.
      </p>

      <div class="nav-clues">
        <article class="nav-clue-panel">
          <h3>Captain's Log Fragment</h3>
          <p>
            "Stitch a fresh <strong>Chart</strong> from the sea's whispers: follow the <strong>Current</strong> that bends toward
            the <strong>Harpoon</strong>, mark the hidden <strong>Anchor</strong>, trace the ridge of submerged <strong>Reefs</strong>,
            and trust the <strong>Tide</strong> to draw the final line."
          </p>
          <p class="nav-clue-note">The emphasized bearings align in order with the proper course.</p>
        </article>
        <article class="nav-clue-panel">
          <h3>Signal Officer Relay</h3>
          <p>The comms array repeats the bearing as pulses. Convert each reading using A = 1.</p>
          <ul class="nav-cipher">
            <li>3 ‚Üí ???</li>
            <li>8 ‚Üí ???</li>
            <li>1 ‚Üí ???</li>
            <li>18 ‚Üí ???</li>
            <li>20 ‚Üí ???</li>
          </ul>
          <p class="nav-clue-note">Log the translated letters from bow to stern.</p>
        </article>
      </div>

      <form class="nav-input-group" id="nav-form" autocomplete="off">
        <label for="nav-answer">Broadcast the five-letter keyword:</label>
        <div class="nav-input-row">
          <input
            type="text"
            id="nav-answer"
            maxlength="5"
            inputmode="text"
            spellcheck="false"
            aria-describedby="nav-feedback"
            placeholder="Enter code"
          />
          <button type="submit" id="nav-submit">Transmit</button>
        </div>
        <p class="nav-feedback" id="nav-feedback" role="status" aria-live="polite"></p>
      </form>

      <div class="nav-hints">
        <button type="button" class="nav-hint-toggle" data-hint="nav-hint-1" data-unlock-attempts="0" aria-expanded="false">
          Reveal hint about the captain's log
        </button>
        <p id="nav-hint-1" class="nav-hint" hidden>
          The log words in bold each start with a letter that lines up to spell the course keyword.
        </p>
        <button
          type="button"
          class="nav-hint-toggle"
          data-hint="nav-hint-2"
          data-unlock-attempts="2"
          aria-expanded="false"
          disabled
        >
          Reveal hint about the signal pulses
        </button>
        <p id="nav-hint-2" class="nav-hint" hidden>
          Convert the pulse numbers to letters with A=1 to verify each position in the keyword.
        </p>
      </div>

      <div class="nav-success" id="nav-success" aria-live="polite" aria-hidden="true">
        <strong>Course Locked!</strong> Keyword confirmed: <span class="keyword">CHART</span>
      </div>
    </div>
  </section>

  <script src="sonar.js"></script>
  <script src="utils.js"></script>
  <script src="navigation.js"></script>
  <script src="control-unlock.js"></script>
  <script src="porthole.js"></script>
  <script src="ballast.js"></script>
  <script src="spot-diff.js"></script>
  <script src="navigation.js"></script>
</body>
</html>
